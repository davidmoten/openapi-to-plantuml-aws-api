<html>
<head>
<script>

function onload() {
    document.getElementById("response").style.display='none';
}

function convert() {
    document.getElementById("response").style.display = 'none';
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function () {
	    if (this.readyState != 4) return;
	
	    if (this.status == 200) {
	    	var resp = JSON.parse(this.responseText);
	    	var puml = document.getElementById("puml");
	        puml.value = resp.puml;
	        var png = document.getElementById("png");
	        png.href = 'https://planttext.com/api/plantuml/img/' + resp.encoded;
	        var svg = document.getElementById('svg'); 
	        svg.href='https://www.planttext.com/api/plantuml/svg/' + resp.encoded;
	        var svgimg = document.getElementById('svgimg');
	        svgimg.src = svg.href;
	        document.getElementById("response").style.display = 'block';
	    }
    };
	xhr.open("POST", "../do", true);
	xhr.setRequestHeader('Content-Type', 'application/yaml');
	xhr.send(
	    document.getElementById("oas").value
	);
}
</script>
</head>
<body onload="onload()">
<h2>Convert OpenApi 3.0 definitions to Plant UML</h2>
<p>Uses the <a href="https://github.com/davidmoten/openapi-to-plantuml">openapi-to-plantuml</a> java library.</p>
<textarea id="oas" style="width:100%;height:40%">
openapi: 3.0.1
info:
  title: unit test
  version: 0.0.1
components:
  schemas:
    # in plantuml need to set namespaceChar none so that grouping doesn't happen on the dot in class name
    My.Customer:
      properties:
        firstName:
          type: string
        lastName:
          type: string
        secret:
          type: string
          format: password
        email:
          type: string
          format: email
        id:
          type: string
          format: uuid
        history:
          type: string
          format: binary
        history2:
          type: string
          format: byte
        heightMetres:
          type: number
        dateOfBirth:
          type: string
          format: date
        lastSessionTime:
          type: string
          format: date-time  
        numberOfChildren:
          type: integer        
        alive:
          type: boolean
        nicknames:
          type: array
          items: 
            type: string
        favouriteNumbers:
          type: array
          items:
            type: integer 
        picture:
          type: string
          format: binary
      required:
      - firstName
      - lastName
      - dateOfBirth
</textarea>
<button style="margin:10px" onclick="convert()">Convert to PlantUML Text</button>
<div id="response">
<a id="png" href="">PNG</a>&nbsp;<a id="svg" href="">SVG</a><br/>
<img id="svgimg" src="" alt="image"/><br/>
<textarea id="puml" readonly style="width:100%;height:40%">
</textarea>
</div>
</body>
</html>